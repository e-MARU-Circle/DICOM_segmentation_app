# Notionグラフ表示Webアプリ開発ログ (2025年8月9日) - Day 2

こんにちは！昨日に引き続き、アプリ開発を進めていきましょう。

## 本日のゴール
- バックエンドとフロントエンドを連携させ、ブラウザにサンプルの3Dグラフを表示させること。

## 行った作業の詳細

### 1. バックエンドに仮のAPIを作成
- **やりたかったこと**: フロントエンドがグラフのデータを取得するための「窓口」(API)をバックエンド(Next.js)に作りたい。
- **何をしたか**: `/api/graph-data` というURLにアクセスすると、サンプルのグラフデータ(JSON形式)を返す機能を作成しました。
- **ファイル**: `graphing-notions/src/app/api/graph-data/route.ts`
- **ポイント**:
    - `route.ts` というファイル名にすることで、Next.jsが自動的にそのファイルをAPIエンドポイントとして認識してくれます。
    - 最初は本物のデータではなく、`nodes`(点)と`links`(線)の構造を持った**仮のデータ**を返すようにしました。こうすることで、まずはフロントエンドとの通信がうまくいくかどうかに集中して確認できます。これを「モック」や「スタブ」と呼んだりします。

### 2. フロントエンドでAPIを呼び出し、グラフを描画
- **やりたかったこと**: フロントエンド(Vite+React)からバックエンドのAPIを呼び出し、受け取ったデータを使って3Dグラフを描画したい。
- **何をしたか**: `3d-force-graph`ライブラリを使って、APIから取得したデータを3Dグラフとして表示するReactコンポーネントを作成しました。
- **ファイル**: `graphing-notions/client/src/App.tsx`
- **ポイント**:
    - `useEffect` というReactのフック(特定のタイミングで処理を行うための機能)を使っています。
    - 1つ目の`useEffect`で、画面が表示された時に1回だけ`fetch`関数を実行し、バックエンドのAPI(`http://localhost:3000/api/graph-data`)からデータを取得します。
    - 取得したデータは`useState`で管理し、データがセットされたら2つ目の`useEffect`が動いて、`ForceGraph3D()`がグラフを描画する、という流れです。

### 3. CORSエラーの解決
- **発生した問題**: フロントエンド(`http://localhost:5173`)からバックエンド(`http://localhost:3000`)にデータを要求したところ、ブラウザに「CORSポリシーによってブロックされました」というエラーが表示されました。
- **原因**: セキュリティのため、ブラウザは異なるオリジン(ドメインやポート番号)間の通信を標準で制限しています。これを「同一オリジンポリシー」と呼びます。
- **どう解決したか**: バックエンド側(Next.js)に、「`http://localhost:5173`からのリクエストは許可しますよ」という特別な許可証(HTTPヘッダー)を発行する設定を追加しました。
- **ファイル**: `graphing-notions/next.config.mjs` (新規作成)
- **ポイント**:
    - `next.config.mjs`は、Next.jsの動作をカスタマイズするための設定ファイルです。
    - `async headers()` 関数の中で、`Access-Control-Allow-Origin`というキーを持つヘッダーを追加することで、CORSの制限を解除できます。
    - 設定ファイルを変更した後は、**開発サーバーの再起動が必要**という点も重要なポイントです。

## 今日のまとめ
今日は、バックエンドとフロントエンドという2つの異なるプログラムを繋ぎ、実際にブラウザに何かを表示させるところまでを体験しました。
特にCORSエラーは、Web開発をしていると頻繁に遭遇する問題なので、今回その原因と解決策を学べたのは大きな一歩です！

これでアプリの土台がしっかりと固まりましたね。
次回は、いよいよ**Step 3: 管理画面と認証**に進み、仮のデータではなく、本物のNotionデータを扱えるようにしていきましょう！
