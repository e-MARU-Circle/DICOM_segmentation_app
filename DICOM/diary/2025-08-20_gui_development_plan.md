# DICOM-STL変換GUIアプリケーション開発計画

## 1. プロジェクト概要

### 目標
「携帯動画変換くん」のように、シンプルで直感的なUIを持つローカルアプリケーションを開発する。ユーザーが数クリックするだけで、DICOM形式の医用画像データから、特定の部位（上顎骨、下顎骨、上顎歯列、下顎歯列、下顎管）がセグメンテーションされたSTL形式の3Dモデルを生成できるようにする。

### ターゲットユーザー
3Dモデルに関する専門知識がない医療従事者や研究者でも、簡単に操作できることを目指す。

### 主な機能
- **入力**: DICOMファイル群が含まれるフォルダ。
- **出力**: 以下の5種類のSTLファイル。
  1. 上顎骨 (Upper_Skull.stl)
  2. 下顎骨 (Mandible.stl)
  3. 上顎歯列 (Upper_Teeth.stl)
  4. 下顎歯列 (Lower_Teeth.stl)
  5. 下顎管 (Mandibular_canal.stl)
- **UI**:
  - 入力・出力フォルダを選択するためのボタン。
  - 処理を開始するための「変換開始」ボタン。
  - 処理の進捗を視覚的に示すプログレスバーと、現在の状況を示すテキストログ。

## 2. 開発ステップ

### ステップ1: GUIの骨格作成 【今回着手】
- **内容**: PySide6を使用し、アプリケーションのメインウィンドウを作成する。この段階では、ボタンやラベルなどの見た目の配置のみを行い、機能は実装しない。
- **目的**: アプリケーションの全体的なレイアウトとデザインを確定させる。

### ステップ2: ファイル選択機能の実装
- **内容**: 「入力フォルダ選択」「出力先選択」ボタンに、フォルダ選択ダイアログを開く機能を実装する。選択されたパスは内部的に保持できるようにする。
- **目的**: ユーザーが処理対象のデータと保存場所を指定できるようにする。

### ステップ3: バックエンド処理との連携
- **内容**: 「変換開始」ボタンが押された際に、既存の処理パイプライン（DICOM→NIfTI→セグメンテーション→STL）をPythonのサブプロセスとして実行するロジックを実装する。Docker用に記述されたスクリプトを、ローカル環境で動作するように調整する。
- **目的**: アプリケーションのコア機能である変換処理をGUIから実行可能にする。

### ステップ4: 進捗表示機能の実装
- **内容**: バックエンド処理の進捗に合わせて、GUIのプログレスバーとテキストログをリアルタイムで更新する。
- **目的**: ユーザーに処理が正常に進行していることを伝え、待ち時間のストレスを軽減する。

### ステップ5: エラーハンドリング
- **内容**: ファイルが見つからない、処理が失敗したなどのエラーを検知し、ユーザーに分かりやすいメッセージで通知する機能を実装する。
- **目的**: 予期せぬ問題が発生した際に、ユーザーが状況を把握し、適切に対応できるようにする。

### ステップ6: パッケージング
- **内容**: PyInstallerなどのツールを使い、Python環境がないPCでも動作する単一の実行可能ファイルを作成する。
- **目的**: アプリケーションの配布を容易にし、誰でも簡単に利用できるようにする。

## 3. 技術スタック
- **GUIフレームワーク**: PySide6 (Qt for Python)
- **バックエンド処理**: dcm2niix, nnU-Net, SimpleITK, scikit-image, numpy-stl (既存資産を流用)
- **パッケージングツール**: PyInstaller (予定)
